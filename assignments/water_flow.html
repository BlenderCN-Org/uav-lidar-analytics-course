<h2>Geospatial simulations of dynamic processes: water flow</h2>

Outline:

<ul>
    <li>
        perform simulation of surface water flow for selected areas
        (select Lake Wheeler road area defined by region rural_1m in nc_spm_08 or Centennial Campus)
    </li>
    <li>optional: assess impact of changes in topography and landuse on water flow pattern and dynamics
</ul>

Data:

<ul>
    <li>
        Note that the vector format has changed between GRASS GIS version 6 and version 7,
        so the best is to use the GRASS GIS 7 version of nc_spm_08 data set.
        Data for GRASS GIS 6 will still work, you just need to rebuild
        the topology using the v.build command.
    </li>
    <li>Location <a href="http://courses.ncsu.edu/mea582/common/media/01/nc_spm_08_grass7.zip">nc_spm_08_grass7 from MEA582</a>
    <li>Location for GRASS GIS 6 <a href="http://courses.ncsu.edu/mea582/common/media/01/nc_spm_08.zip">nc_spm_08 from MEA582</a>
    <li>Mapset for GRASS GIS 6 <a href="../gisdata/cc_south.zip">Centennial Campus South Mapset</a>
    <!--<li>LOCATION north_carolina_spm used in <a href="a_stc.html">the previous assignment</a>-->
</ul>

Start GRASS - click on GRASS icon or type

<pre><code>
grass70
</code></pre>

<p>
Set the following values in the start up window:
<ul>
    <li><em>GRASS data directory</em> to, for example /home/john/grassdata<br>
    <li>for <em>Location</em> select nc_spm_08_grass7<br>
    <li>for <em>Mapset</em> select user1<br>
</ul>

Then start GRASS session, GUI opens automatically.
You can work in GUI, in command console in GUI or the system
command line (terminal, console) which started with GRASS GIS.

<p>
compute spatial pattern of overland flow depth and discharge<br>
compute input raster maps for uniform land cover and uniform rainfall excess<br>

<pre><code>
g.region rural_1m res=2 -p
r.mapcalc "man05 = 0.05"
r.mapcalc "infil0 = 0."
r.mapcalc "rain50mmhr = 50."
</code></pre>

<p>
calculate partial derivatives to define the gradient of elevation surface<br>

<pre><code>
v.surf.rst -d in=elev_lid792_bepts elev=elev_lid792_2m slop=dx_2m asp=dy_2m ten=15 smooth=1.5 npmin=150
</code></pre>

<p>
run the model<br>
remove backslashes when running from GUI command console<br>

<pre><code>
r.sim.water -t elev=elev_lid792_2m dx=dx_2m dy=dy_2m rain=rain50mmhr infil=infil0 man=man05 \
          depth=wdp_2m disch=disch_2m nwalk=400000 niter=25 outit=1 hmax=0.2 halpha=8.0 hbeta=1.0
d.rast wdp_2m.020
d.rast disch_2m.020
</code></pre>

<p>
animate the time series File > Animation tool<br>

compute peak runoff with predefined flow direction<br>
along the stream inluding culvert under the road<br>
compute direction (aspect) of the given streams<br>

<pre><code>
v.to.rast streams out=streams_dir_2m use=dir
</code></pre>

<p>
compute stream dx,dy using direction and slope=2deg<br>

<pre><code>
r.mapcalc "dxstr_2m = tan(2.)*cos(streams_dir_2m)"
r.mapcalc "dystr_2m = tan(2.)*sin(streams_dir_2m)"
</code></pre>

<p>
compute combined DEM and stream dx,dy<br>

<pre><code>
r.mapcalc "dxdemstr_2m = if(isnull(dxstr_2m), dx_2m, dxstr_2m)"
r.mapcalc "dydemstr_2m = if(isnull(dystr_2m), dy_2m, dystr_2m)"
</code></pre>

<p>
run the model<br>

<pre><code>
r.sim.water -t elev=elev_lid792_2m dx=dxdemstr_2m dy=dydemstr_2m rain=rain50mmhr infil=infil0 man=man05 \
      depth=wdpstr_2m disch=dischstr_2m nwalk=400000 niter=25 outit=1 hmax=0.2 halpha=8.0 hbeta=1.0
d.rast dischstr_2m.020
</code></pre>

<p>
Compute runoff for spatially variable landcover
represented by  spatially variable Mannings and infiltration variable Mannings
(<a href="http://courses.ncsu.edu/gis582/common/grass/data/lu_labels.txt">lu_labels.txt</a>).

<pre><code>
r.recode landcover_1m out=mancover_2m
</code></pre>

<pre><code>
1:1:0.9:0.9
2:2:0.5:0.5
3:3:0.01:0.01
4:4:0.03:0.03
5:5:0.01:0.01
6:6:0.05:0.05
7:7:0.1:0.1
8:8:0.1:0.1
9:9:0.9:0.9
10:10:0.03:0.03
11:11:0.5:0.5
</code></pre>

<p>
variable rainfall excess (rainfall intensity - infitration rate)<br>

<pre><code>
r.recode landcover_1m out=raincover_2m
</code></pre>

<pre><code>
1:1:50:50
2:2:5:5
3:3:40:40
4:4:35:35
5:5:50:50
6:6:40:40
7:7:25:25
8:8:15:15
9:9:50.:50.
10:10:40:40 
11:11:10:10 
</code></pre>

<p>
run the model<br>

<pre><code>
r.sim.water -t elev=elev_lid792_2m dx=dxdemstr_2m dy=dydemstr_2m rain=raincover_2m infil=infil0 \
               man=mancover_2m depth=wdpstrcov_2m disch=distrcov_2m nwalk=400000 niter=25 outit=1 \
               hmax=0.2 halpha=8.0 hbeta=1.0
d.rast wdpstrcov_2m.20
d.legend wdpstrcov_2m.20
d.rast distrcov_2m.20
d.legend distrcov_2m.20 
</code></pre>

<p>
run animation<br>

<pre><code>
</code></pre>

<p>
compute sediment flow rate and net erosion/deposition using simwe<br>
set region to the upper part of the watershed<br>

<pre><code>
g.region s=s+290
</code></pre>

<p>
compute input transport capacity and detachment coef. maps<br>

<pre><code>
r.mapcalc "tranin = 0.001"
r.mapcalc "detin = 0.001"
</code></pre>

<p>
compute input critical shear stress<br>

<pre><code>
r.mapcalc "tauin = 0.01"
</code></pre>

<p>
run the model, use last depth from previous run<br>

<pre><code>
g.copy rast=wdp_2m.140,wdp_2m
r.sim.sediment elev=elev_lid792_2m dx=dx_2m dy=dy_2m wdepth=wdp_2m det=detin tran=tranin \
      tau=tauin man=man05 nwalk=600000 niter=600 tc=tcapacity et=erdepmax flux=sedflow erdep=erdepsimwe
</code></pre>

<p>
display these results after few seconds:<br>

<pre><code>
d.rast tcapacity
d.rast erdepmax
</code></pre>

<p>
display the final results<br>

<pre><code>
d.rast sedflow 
d.legend sedflow
d.rast erdepsimwe
d.legend erdepsimwe
<P>Simulations for the Centennial Campus
</code></pre>

<p>
save the provided cc_south MAPSET in the nc_spm_08_grass7 directory<br>
Using the 2001, 3m resolution NED LE_ned_3m<br>
perform watershed analysis (flowaccumulation and watershed boundaries),<br>
generate countours in a subregion<br>

<pre><code>
g.region lakeraleigh_3m -p
r.watershed LR_ned_3m accum=LR_accum basin=LR_basin thre=10000
g.region lakeraleighzm_3m -p
r.contour LR_ned_3m out=LR_ned_3m_cont2 step=2
</code></pre>

<p>
analyze overland flow for the years 2001<br>
TODO - ADD NEW DEM for comparison!!!<br>
compare results for the reprojected USGS LR_ned_3m and lidar-based DEM<br>
prepare uniform input and run simwe, show the impact of Mannings on the result<br>
use rain parameter to provide raifall excess (rainfall-infiltration)<br>
use infil parameter to simulate infiltration of flowing water (flow-infiltration)<br>

<pre><code>
r.mapcalc "man015 = 0.15"
r.mapcalc "man005 = 0.05"
r.mapcalc "infil0 = 0."
r.mapcalc "rain25mmhr = 25"
r.slope.aspect LR_ned_3m dx=ned3m_dx dy=ned3m_dy
r.sim.water -t elev=LR_ned_3m dx=ned3m_dx dy=ned3m_dy rain=rain25mmhr infil=infil0 man=man015 \
depth=nedwdp_3m_n015 disch=nedisch_3m_n015 nwalk=100000 niter=30 outit=1 hmax=0.2 halpha=8.0 hbeta=1.0 --o
r.sim.water -t elev=LR_ned_3m dx=ned3m_dx dy=ned3m_dy rain=rain25mmhr infil=infil0 man=man005 \
depth=nedwdp_3m_n005 disch=nedisch_3m_n005 nwalk=100000 niter=30 outit=1 hmax=0.2 halpha=8.0 hbeta=1.0 --o
</code></pre>

<p>
if the data set has 2013 DEM perform the same analysis and compare the results<br>
<!--
#output and animate the particles
r.sim.water -t elev=elev_rand3m dx=dx_3m dy=dy_3m rain=rain25mmhr infil=infil0 man=man0.15 \
disch=tdisch_3mn1 outwalk=lr_walk nwalk=100000 niter=30 outit=2 hmax=0.2 halpha=8.0 hbeta=1.0
-->
