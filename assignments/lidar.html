<h2>Topic:  Analyzing and Visualizing surfaces from multiple return lidar data</h2>

<ul>
<li>analyze and import lidar point cloud for State Farmers Market near NC State Centennial Campus
<li>compute bare earth and canopy surfaces and derived parameters
<li>employ visualization techniques to highlight subtle terrain features
<li>explore voxel model based analysis of multiple return point cloud
</ul>
Data: 
<ul>
<li>GRASS LOCATION <a href="http://courses.ncsu.edu/mea592/common/media/nc_spf_centennial.zip">nc_spf_centennial</a>
<li><a href="http://courses.ncsu.edu/mea582/common/media/01/0793_016.las.zip">Classified point cloud tile 16 in las format</a>
<li><a href="http://courses.ncsu.edu/mea582/common/media/01/0793_016_xyzirnc_ncspf.zip">Point cloud tile in asci xyzirnc format</a>
</ul>
Tools:
<ul>
<li>download recent version of <a href="http://wingrass.fsv.cvut.cz/grass70/">GRASS GIS 7</a>
which includes also <a href="http://www.liblas.org/">libLAS</a> library,
accessible through GRASS modules v.in.lidar/r.in.lidar or using tools lasinfo, las2txt tools </li>
</ul>
<hr>
Quick data exploration<br>

first view the LAS file in your web browser using <a href="http://plas.io"><b>plas.io</b></a><br>
(might not work with older browsers, use chrome)<br>

then launch GRASS<br>
all following commands should be pasted in the GUI command line<br>

<pre>
grass70
</pre>

<p>
go to the directory where we downloaded the las file<br>

<pre>
cd ~/Downloads <font color="#000066"># or just type cd and press enter</font>
</pre>

<p>
let's look at the metadata, particularly at the classes,<br>
we will further work work with the classes 1 and 2<br>

<pre>
lasinfo 0793_016.las
</pre>

<p>
...<br>
Point Classifications<br>
---------------------------------------------------------<br>
341246 Unclassified (1)<br>
560224 Ground (2)<br>
25 Low Point (noise) (7)<br>
844382 Reserved for ASPRS Definition (11)<br>

get the geographic extent of the point cloud and then set it<br>

<pre>
r.in.lidar -sgo input=0793_016.las
g.region n=734999.990000 s=732500.010000 e=2099999.990000 w=2097500.000000
</pre>

<p>

Density of points<br>

first we set the resolution<br>

<pre>
g.region res=3
</pre>

<p>
compute the density of all points<br>

<pre>
r.in.lidar -o input=0793_016.las output=tile16_dens_all method=n
d.rast tile16_dens_all
d.legend -f -s -d rast=tile16_dens_all at=5,50,7,10
</pre>

<p>
compute the density of ground points<br>

<pre>
r.in.lidar -o input=0793_016.las output=tile16_dens_ground class_filter=2 method=n
d.rast tile16_dens_ground
d.legend -f -s -d rast=tile16_dens_ground at=5,50,7,10
</pre>

<p>

High resolution DEM/DSM<br>

import as points (without attribute table, not necessary to build points)<br>

<pre>
v.in.lidar -t -o input=0793_016.las output=tile16_ground class_filter=2
v.in.lidar -t -o input=0793_016.las output=tile16_surface class_filter=1,2 return_filter=first
</pre>

<p>
remove the vector layers from your Layer Manager if they were added<br>

interpolate with resolution 3 feet<br>
also create slope and profile curvature map<br>
set higher npmin to reduce artifacts from segmentation visible on slope and curvature maps (will be much slower!)<br>

<pre>
v.surf.rst input=tile16_ground elevation=tile16_ground_elev slope=tile16_ground_slope pcurv=tile16_ground_profcurv dmin=1 npmin=80 tension=10 smooth=10
v.surf.rst input=tile16_surface elevation=tile16_surface_elev slope=tile16_surface_slope pcurv=tile16_surface_profcurv dmin=1 npmin=80 tension=20 smooth=1
</pre>

<p>
visualize DEM and DSM in 3D view, use cross-sections<br>


Raster binning and classification<br>

compute different surfaces by binning<br>
explore what different returns and classes show<br>
create a raster map of classes: 1 - ground, 2 - vegetation, 3 - buildings<br>

create DSM<br>

<pre>
r.in.lidar -o input=0793_016.las output=tile16_all_max method=max resolution=10 class_filter=1,2
</pre>

<p>
create surface based on last return (represents canopy)<br>

<pre>
r.in.lidar -o input=0793_016.las output=tile16_last_mean resolution=10 method=mean return_filter=last class_filter=1,2
</pre>

<p>
create surface representing ground based on already classified points<br>

<pre>
r.in.lidar -o input=0793_016.las output=tile16_ground_mean resolution=10 class_filter=2
</pre>

<p>
combine surfaces and create classes: 1 - ground, 2 - vegetation, 3 - buildings<br>

<pre>
r.mapcalc "classes = if( ! isnull(tile16_last_mean), 2, if( !isnull( tile16_ground_mean), 1, if( !isnull(tile16_all_max),3, null())))"
</pre>

<p>
set colors, copy and paste the following color rules into "or enter values directly" text field located in Define tab (option rules)<br>

<pre>
r.colors map=classes 
1 220:220:180
2 0:180:0
3 150:0:0

</pre>

<p>
leave just raster map 'tile16_surface_elev' in Layer Manager, hide legend<br>
got to 3D view, set surface resolution 1 and color to map 'classes'<br>


Visualize point density in 3D (optional)<br>

convert LAS file into text file with lastools<br>

<pre>
las2txt -i 0793_016.las --parse xyzc -o tile16.txt
</pre>

<p>
set region for creating the 3D raster<br>

<pre>
g.region n=734617 s=733919 w=2098538 e=2099470 b=300 t=450 res=10 res3=10 tbres=25 -p3
</pre>

<p>
use binning to create point density 3D raster<br>

<pre>
r3.in.xyz input=tile16.txt output=tile16_dens method=n separator=comma
</pre>

<p>
visualize in 3D view using slices and isosurfaces
