<h1>Terrain Anaysis of the flight site using GIS</h1>

<p>In order to execute a safe flight, you need to make sure that the flight path will not cross any
obstacles. Also remember that the ground altitude is measured in the take off localization and
does not take into account local relief. It can be crucial in the mountainous areas. In our case
trees, buildings and other man-made structures are more of a concern.
Because both – terrain data (from lidar) and planned flight path (generated by you in the Trimble
Aerial Imaging software) are available, the the elevation difference between the flight celling and
the surface can be computed using GIS tools.</p>

<h4>
General workflow (with GCPs):</h4>

<ol>
    <li>Compute a raster for elevation of the flight path
    <li>Generate DSM
    <li>Calculate the elevation difference between the flight path and surface
</ol>


<h4>Data</h4>

<ul>
    <li>2013 lidar data <a href="http://fatra.cnr.ncsu.edu/uav-lidar-analytics-course/secref_spm_2013.las"> SECREF</a> and <a href="http://fatra.cnr.ncsu.edu/uav-lidar-analytics-course/mid_pines_spm_2013.las" Mid Pines </a>

<h4>Software</h4>

<ul>
    <li><a href="http://grass.osgeo.org/">GRASS GIS 7.0.1</a>
    <li>Trimble Aerial Imaging<a href="https://drive.google.com/open?id=0B1AfQGDB8tPXRWo0TGl1a3ZVMDQ">installation file (Windows)</a>
</ul>

<h3>Compute a raster for elevation of the flight path</h3>

<ul>
    <li>Export a flight plan path that you created to the kml file from Trimble Aerial Imaging .gwt project</li>
    <li>Launch GRASS</li>
    <li>install the v.import package
<pre><code>
g.extension extension=v.import svnurl=http://svn.osgeo.org/grass/grass-addons/grass7
</code></pre>
    <li>Import generatred kml into GRASS
<pre><code>
v.import input=exported_kml_file.kml output=flight_path
</code></pre>
    <li>Convert vector line to elevation points. Set the maximum distance between the point as 0.3 m
<pre><code>
v.to.points -i input=flight_track_kml output=flight_track_points dmax=0.3
</code></pre>
     <li>Convert vector to raster
<pre><code>
v.to.rast input=flight_track_points output=flight_path_altitude_rast use=z
</code></pre>
     <li>Make the flight path line thick (wide) enough taking to account the wingspan of the UAV and weather impacts on the flight trajectory. Desired width of the path = 5m (radius 2.5m)
<pre><code>
r.grow -m input=flight_path_altitude_rast output=flight_path_wide radius=2.5
</code></pre>
</ul>


<h3>Generate DSM (Option A or option B)</h3>
<h4>A. Using lidar data</h4>

<ul>
    <li>Download lidar data for m<a href="http://fatra.cnr.ncsu.edu/uav-lidar-analytics-course/secref_spm_2013.las"> SECREF</a> and <a href="http://fatra.cnr.ncsu.edu/uav-lidar-analytics-course/mid_pines_spm_2013.las"> Mid Pines </a> to your computer</li>
    
    <li>Import lidar data to grass
<pre><code>
v.in.lidar -o input=secref_spm_2013.las class_filter=1,2 out=secref_lidar2013_dsm return_filter=first
v.in.lidar -o input=mid_pines_spm_2013.las class_filter=1,2 out=mid_pines_lidar2013_dsm return_filter=first
</code></pre>
    <li>Interpolate DSM
<pre><code>
g.region vector=mid_pines_lidar2013_dsm res=0.3 –ap
v.surf.rst input=mid_pines_lidar2013_dsm elevation=mid_pines_lidar2013_dsm tension=20 smooth=2 npmin=200 dmin=0.3
<br>
g.region vector=secref_lidar2013_dsm res=0.3 –ap
v.surf.rst input=secref_lidar2013_dsm elevation=secref_lidar2013_dsm tension=20 smooth=2 npmin=200 dmin=0.3
</code></pre>
 </ul>



<h4>B. Import existing DSM into GRASS</h4>
<ul>
    <li>Download <a href="http://fatra.cnr.ncsu.edu/uav-lidar-analytics-course/secref_mid_pines_spm_elev.zip"> zip files</a> and unpack them.
    <li>Import data to GRASS
<pre><code>
r.unpack -o input=...your_location...\secref_lidar2013_dsm.pack
r.unpack -o input=...your_location...\mid_pines_lidar2013_dsm.pack
</code></pre>
</ul>
<h3>Calculate the elevation difference between the flight path and surface</h3>
<ul>
    <li>Use map algebra to compute difference between two rasters - elevation of your flight path and Surface of the terrain
<pre><code>
r.mapcalc expression=elev_diff = flight_path_wide - mid_pines_lidar2013_dsm
r.mapcalc expression=elev_diff = flight_path_wide - secref_lidar2013_dsm
</code></pre>
</ul>


























