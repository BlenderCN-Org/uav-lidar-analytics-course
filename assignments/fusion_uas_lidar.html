<h2>Fusion of uas and lidar data</h2>

Outline:

<ul>
    <li>analyze the differences between the lidar and uas DEM/DSM
    <li>fuse lidar and uas DSM for viewshed analysis: compare simple patching with map algebra 
        with reinterpolation from maximum elevation points
</ul>

Data: you should already have both the lidar and uas DSMs and points clouds.

<p>
Tools:

<ul>
    <li>
        Your <a href="http://wingrass.fsv.cvut.cz/grass70/">GRASS GIS 7</a>
        installation should also include <a href="http://www.liblas.org/">libLAS</a> library
        which is used by GRASS modules v.in.lidar and r.in.lidar
        (standalone GRASS GIS for MS Windows, OSGeo4W and Ubuntu packages contain libLAS).
    </li>
    <li>libLAS installation should include command line tools lasinfo and las2txt.
</ul>

<h3>Analyze the difference between the lidar and UAS DSM </h3>

First we need to evaluate the DSMs to find out which are suitable for fusion
<ul>
 <li> compare errors at GCPs (lidar, agisoft, trimble or pix4d in june)
 <li> compute the difference between lidar DSM and selected uas: raster, profile/difference along a road and roof
 <li> use above to identify potential systematic error (you will see approx constant shift in profiles
and most difs have the same sign, use mean or median as syst. error estimate, re-do the profile
to verify the correction), use Mitasova et al. 2009 for reference
 <li> identify distortions - use corrected dsm and lid-uav diff, 
 look for unexpected pattern, verify with profile.
 Put into report and exclude distorted areas from study area.
 Why are the distortions / errors low along the road but high in the fields?
 What would you have to do if you needed to correct the distorted area
(add gcps using stable features in lidar and reprocess)
 <li> now you have two DSMs: corrected lidar DSM and (corrected) low-distortion subset of UAS DSM:
      create a new DSM for the entire area using at least two approaches
      and compare how the two approaches work for viewshed mapping
</ul>

Suggested color table for differences, used in the workflow as dif_lidar_uav.txt:

<pre><code>
 -40 red
 -1 orange
 -0.5 yellow
 -0.1 grey
 0 white
 0.1 grey
 0.5 cyan
 1 aqua
 35 blue
</code></pre>

Compute the differences between the lidar and uav DSMs

<pre><code>
g.region rast=mid_pines_lidar2013_dsm -p
r.mapcalc "diff_lidardsm_agi_june = mid_pines_lidar2013_dsm - 2015_06_20_DSM_agi_11GCP"
r.colors diff_lidardsm_agi_june rules=dif_lidar_uav.txt
r.mapcalc "diff_lidardsm_pix4d_june = mid_pines_lidar2013_dsm - 2015_06_20_pix4d_11GCP_dsm"
r.colors diff_lidardsm_pix4d_june rules=dif_lidar_uav.txt
</code></pre>

Evaluate possible systematic shift along stable features using the profile tool or the following commands

<pre><code>
r.profile -g input=diff_lidardsm_agi_june output=road.txt coordinates=637208,219491,637059,219734
v.in.ascii input=road.txt output=profile_road separator=space columns="x double,y double,profile double,diff double"
v.univar map=profile_road column=diff
</code></pre>

Select the region with minimal distortion in the UAS DSM and compute clipped DSM

<pre><code> 
g.region n=219735 s=219355 e=637000 w=636675
r.mapcalc  "uas_june_agi11gcp_03m_cl = uas_june_agi11gcp_03m * 1."
</code></pre>

Compute patched and fused DSM.
Compare viewshed from lidar only, uas only, fused.
Compare flow in a similar way.

<!--
<pre><code> </code></pre>
<pre><code> </code></pre>
<pre><code> </code></pre>
<pre><code> </code></pre>
<pre><code> </code></pre>
<pre><code> </code></pre>


First, add the columns:

<pre><code>
v.db.addcolumn map=GCP_12_degrees columns="dem_height DOUBLE, height_difference DOUBLE"
</code></pre>

Query (sample) the raster elevation at the locations of GCPs:

<pre><code>
v.what.rast -i map=GCP_12_degrees raster=mid_pines_ground_elev column=dem_height
</code></pre>

Compute the difference and save it in the attribute column:

<pre><code>
v.db.update map=GCP_12_degrees column=height_difference query_column="ASL - dem_height"
</code></pre>

View at the results:

<pre><code>
v.db.select map=GCP_12_degrees columns=ASL,dem_height,height_difference
</code></pre>

Alternatively use <em>Attribute Table Manager</em> to view the results.



<h3>Visualize point density in 3D (optional)</h3>

Convert LAS file into text file:

<pre><code>
las2txt -i mid_pines_spm_2013.las --parse xyzc -o mid_pines.txt
</code></pre>

<p>
Set smaller region for creating the 3D raster (TBD):

<pre><code>
g.region n= s= w= e= b= t= res=10 res3=3 tbres=8 -p3
</code></pre>

<p>
Use binning to create point density 3D raster:

<pre><code>
r3.in.xyz input=mid_pines.txt output=mid_pines_dens method=n separator=comma
</code></pre>

<p>
Visualize in 3D view using slices and isosurfaces.
-->
